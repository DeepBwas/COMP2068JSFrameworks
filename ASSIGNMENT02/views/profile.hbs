<div class="profile-page">
  {{> upload 
  uploadId="avatar-upload"
  fileInputId="avatar-input"
  fieldName="avatar"
  title="Upload Avatar"
  subtitle="Choose a profile picture"
  action="/profile/avatar/upload"
}}

{{> delete 
  modalId="delete-avatar-modal"
  title="Delete Avatar"
  message="Are you sure you want to remove your avatar? This action cannot be undone."
  onConfirm="removeAvatar()"
}}
  <div class="profile-sidebar">
    <div class="tab-list">
      <button class="tab-btn active" data-tab="general">General</button>
      <button class="tab-btn" data-tab="account">Account</button>
      <button class="tab-btn" data-tab="security">Security</button>
    </div>
  </div>

  <div class="profile-content">
    <div class="tab-content active" id="general">
      <h2>General Settings</h2>

      <div class="profile-avatar-section">
        <div class="header-avatar">
          <div class="avatar" data-upload-trigger="avatar-upload" title={{user.username}}>
            {{#if user.avatarUrl}}
              <img src="{{user.avatarUrl}}" alt="{{user.username}}'s avatar" class="avatar-image">
            {{else}}
              {{getInitials user.username}}
            {{/if}}
            <div class="avatar-overlay">
              <span class="material-icons">edit</span>
            </div>
          </div>
        </div>
        {{#if user.avatarUrl}}
          <button class="remove-avatar-btn" onclick="showDeleteModal('delete-avatar-modal')">
            <span class="material-icons">delete</span>
            Remove Avatar
          </button>
        {{/if}}
        <span class="profile-username">{{user.username}}</span>
      </div>

      <form
        action="/profile/update/general"
        method="POST"
        class="settings-form"
      >
        <div class="form-group">
          <label for="username">Username</label>
          <input
            type="text"
            id="username"
            name="username"
            value="{{user.username}}"
            required
          />
        </div>
        <div class="form-group">
          <label for="bio">Bio</label>
          <textarea id="bio" name="bio">{{user.bio}}</textarea>
        </div>
        <button type="submit" class="update-btn">Update General Settings</button>
      </form>
      <button
        class="logout-btn"
        onclick="location.href='/auth/logout'"
      >Logout</button>
    </div>

    <div class="tab-content" id="account">
      <h2>Account Settings</h2>
      <form
        action="/profile/update/account"
        method="POST"
        class="settings-form"
      >
        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            value="{{user.email}}"
            required
          />
        </div>
        <button type="submit" class="update-btn">Update Email</button>
      </form>
    </div>

    <div class="tab-content" id="security">
      <h2>Security Settings</h2>
      <form
        action="/profile/update/password"
        method="POST"
        class="settings-form"
      >
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input
            type="password"
            id="currentPassword"
            name="currentPassword"
            required
          />
        </div>
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" name="newPassword" required />
        </div>
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            required
          />
        </div>
        <button type="submit" class="update-btn">Update Password</button>
      </form>
    </div>
  </div>
</div>